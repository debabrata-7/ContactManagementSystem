"use strict";

require("core-js/modules/es.object.define-property.js");
require("core-js/modules/es.symbol.iterator.js");
require("core-js/modules/es.array.iterator.js");
require("core-js/modules/es.string.iterator.js");
require("core-js/modules/web.dom-collections.iterator.js");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;
require("core-js/modules/es.array.for-each.js");
require("core-js/modules/es.object.to-string.js");
require("core-js/modules/web.dom-collections.for-each.js");
require("core-js/modules/es.function.name.js");
require("core-js/modules/es.array.map.js");
require("core-js/modules/es.string.trim.js");
require("core-js/modules/es.array.includes.js");
require("core-js/modules/es.string.includes.js");
require("core-js/modules/es.regexp.exec.js");
require("core-js/modules/es.string.replace.js");
require("core-js/modules/es.array.join.js");
require("core-js/modules/es.array.splice.js");
require("core-js/modules/es.string.split.js");
require("core-js/modules/es.parse-int.js");
require("core-js/modules/es.array.find.js");
require("core-js/modules/es.symbol.to-primitive.js");
require("core-js/modules/es.date.to-primitive.js");
require("core-js/modules/es.symbol.js");
require("core-js/modules/es.symbol.description.js");
require("core-js/modules/es.number.constructor.js");
var _path = _interopRequireDefault(require("path"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }
function _typeof(o) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o; }, _typeof(o); }
function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }
function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }
function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, "prototype", { writable: false }); return Constructor; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return _typeof(key) === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); } /* eslint-disable class-methods-use-this */ /**
                                                                                                                                                                                                                                                                                                                                                                                                                                           * Copyright (c) 2014-present, Facebook, Inc. All rights reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                           *
                                                                                                                                                                                                                                                                                                                                                                                                                                           * This source code is licensed under the MIT license found in the
                                                                                                                                                                                                                                                                                                                                                                                                                                           * LICENSE file in the root directory of this source tree.
                                                                                                                                                                                                                                                                                                                                                                                                                                           *
                                                                                                                                                                                                                                                                                                                                                                                                                                           * 
                                                                                                                                                                                                                                                                                                                                                                                                                                           */
/**
 *  You have a Jest test runner watching for changes, and you have
 *  an extension that wants to know where to show errors after file parsing.
 *
 *  This class represents the state between runs, keeping track of passes/fails
 *  at a file level, generating useful error messages and providing a nice API.
 */
var TestReconciler = exports["default"] = /*#__PURE__*/function () {
  function TestReconciler() {
    _classCallCheck(this, TestReconciler);
    this.fileStatuses = {};
  }

  // the processed test results will be returned immediately instead of saved in
  // instance properties. This is 1) to prevent race condition 2) the data is already
  // stored in the this.fileStatuses, no dup is better 3) client will most likely need to process
  // all the results anyway.
  _createClass(TestReconciler, [{
    key: "updateFileWithJestStatus",
    value: function updateFileWithJestStatus(results) {
      var _this = this;
      // Loop through all files inside the report from Jest
      var statusList = [];
      results.testResults.forEach(function (file) {
        // Did the file pass/fail?
        var status = _this.statusToReconcilationState(file.status);
        // Create our own simpler representation
        var fileStatus = {
          assertions: _this.mapAssertions(file.name, file.assertionResults),
          file: file.name,
          message: file.message,
          status: status
        };
        _this.fileStatuses[file.name] = fileStatus;
        statusList.push(fileStatus);
      });
      return statusList;
    }

    /**
     * remove jest status of the test file from the cached results
     * @param {string} fileName
     */
  }, {
    key: "removeTestFile",
    value: function removeTestFile(fileName) {
      delete this.fileStatuses[fileName];
    }

    // A failed test also contains the stack trace for an `expect`
    // we don't get this as structured data, but what we get
    // is useful enough to make it for ourselves
  }, {
    key: "mapAssertions",
    value: function mapAssertions(filename, assertions) {
      var _this2 = this;
      // convert jest location (column is 0-based and line is 1-based) to all 0-based location used internally in this package
      /* eslint-disable no-param-reassign */
      var convertJestLocation = function convertJestLocation(jestLocation) {
        if (jestLocation) {
          jestLocation.line -= 1;
        }
        return jestLocation;
      };
      // Is it jest < 17? e.g. Before I added this to the JSON
      if (!assertions) {
        return [];
      }

      // Change all failing assertions into structured data
      return assertions.map(function (assertion) {
        // Failure messages seems to always be an array of one item
        var message = assertion.failureMessages && assertion.failureMessages[0];
        var _short = null;
        var terse = null;
        var line = null;
        var location = convertJestLocation(assertion.location); // output from jest --testLocationInResults (https://jestjs.io/docs/en/cli#testlocationinresults)
        if (message) {
          // Just the first line, with little whitespace
          _short = message.split('   at', 1)[0].trim();
          // this will show inline, so we want to show very little
          terse = _this2.sanitizeShortErrorMessage(_short);
          line = _this2.lineOfError(message, filename);
        }
        return {
          line: line,
          message: message || '',
          shortMessage: _short,
          status: _this2.statusToReconcilationState(assertion.status),
          terseMessage: terse,
          title: assertion.title,
          location: location,
          fullName: assertion.fullName,
          ancestorTitles: assertion.ancestorTitles
        };
      });
    }

    // Do everything we can to try make a one-liner from the error report
  }, {
    key: "sanitizeShortErrorMessage",
    value: function sanitizeShortErrorMessage(string) {
      if (string.includes('does not match stored snapshot')) {
        return 'Snapshot has changed';
      }
      if (string.includes('New snapshot was not written')) {
        return 'New snapshot is ready to write';
      }
      return string.split('\n').splice(2).join('').replace(/\s\s+/g, ' ').replace('Received:', ', Received:').split('Difference:')[0];
    }

    // Pull the line out from the stack trace
  }, {
    key: "lineOfError",
    value: function lineOfError(message, filePath) {
      var filename = _path["default"].basename(filePath);
      var restOfTrace = message.split(filename, 2)[1];
      return restOfTrace ? parseInt(restOfTrace.split(':')[1], 10) : null;
    }
  }, {
    key: "statusToReconcilationState",
    value: function statusToReconcilationState(status) {
      switch (status) {
        case 'passed':
          return 'KnownSuccess';
        case 'failed':
          return 'KnownFail';
        case 'pending':
          return 'KnownSkip';
        case 'todo':
          return 'KnownTodo';
        default:
          return 'Unknown';
      }
    }
  }, {
    key: "stateForTestFile",
    value: function stateForTestFile(file) {
      var results = this.fileStatuses[file];
      if (!results) {
        return 'Unknown';
      }
      return results.status;
    }
  }, {
    key: "assertionsForTestFile",
    value: function assertionsForTestFile(file) {
      var results = this.fileStatuses[file];
      return results ? results.assertions : null;
    }
  }, {
    key: "stateForTestAssertion",
    value: function stateForTestAssertion(file, name) {
      var results = this.fileStatuses[file];
      if (!results || !results.assertions) {
        return null;
      }
      var assertion = results.assertions.find(function (a) {
        return a.title === name;
      });
      if (!assertion) {
        return null;
      }
      return assertion;
    }
  }]);
  return TestReconciler;
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcGF0aCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwib2JqIiwiX19lc01vZHVsZSIsIl90eXBlb2YiLCJvIiwiU3ltYm9sIiwiaXRlcmF0b3IiLCJjb25zdHJ1Y3RvciIsInByb3RvdHlwZSIsIl9jbGFzc0NhbGxDaGVjayIsImluc3RhbmNlIiwiQ29uc3RydWN0b3IiLCJUeXBlRXJyb3IiLCJfZGVmaW5lUHJvcGVydGllcyIsInRhcmdldCIsInByb3BzIiwiaSIsImxlbmd0aCIsImRlc2NyaXB0b3IiLCJlbnVtZXJhYmxlIiwiY29uZmlndXJhYmxlIiwid3JpdGFibGUiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsIl90b1Byb3BlcnR5S2V5Iiwia2V5IiwiX2NyZWF0ZUNsYXNzIiwicHJvdG9Qcm9wcyIsInN0YXRpY1Byb3BzIiwiYXJnIiwiX3RvUHJpbWl0aXZlIiwiU3RyaW5nIiwiaW5wdXQiLCJoaW50IiwicHJpbSIsInRvUHJpbWl0aXZlIiwidW5kZWZpbmVkIiwicmVzIiwiY2FsbCIsIk51bWJlciIsIlRlc3RSZWNvbmNpbGVyIiwiZXhwb3J0cyIsImZpbGVTdGF0dXNlcyIsInZhbHVlIiwidXBkYXRlRmlsZVdpdGhKZXN0U3RhdHVzIiwicmVzdWx0cyIsIl90aGlzIiwic3RhdHVzTGlzdCIsInRlc3RSZXN1bHRzIiwiZm9yRWFjaCIsImZpbGUiLCJzdGF0dXMiLCJzdGF0dXNUb1JlY29uY2lsYXRpb25TdGF0ZSIsImZpbGVTdGF0dXMiLCJhc3NlcnRpb25zIiwibWFwQXNzZXJ0aW9ucyIsIm5hbWUiLCJhc3NlcnRpb25SZXN1bHRzIiwibWVzc2FnZSIsInB1c2giLCJyZW1vdmVUZXN0RmlsZSIsImZpbGVOYW1lIiwiZmlsZW5hbWUiLCJfdGhpczIiLCJjb252ZXJ0SmVzdExvY2F0aW9uIiwiamVzdExvY2F0aW9uIiwibGluZSIsIm1hcCIsImFzc2VydGlvbiIsImZhaWx1cmVNZXNzYWdlcyIsInNob3J0IiwidGVyc2UiLCJsb2NhdGlvbiIsInNwbGl0IiwidHJpbSIsInNhbml0aXplU2hvcnRFcnJvck1lc3NhZ2UiLCJsaW5lT2ZFcnJvciIsInNob3J0TWVzc2FnZSIsInRlcnNlTWVzc2FnZSIsInRpdGxlIiwiZnVsbE5hbWUiLCJhbmNlc3RvclRpdGxlcyIsInN0cmluZyIsImluY2x1ZGVzIiwic3BsaWNlIiwiam9pbiIsInJlcGxhY2UiLCJmaWxlUGF0aCIsInBhdGgiLCJiYXNlbmFtZSIsInJlc3RPZlRyYWNlIiwicGFyc2VJbnQiLCJzdGF0ZUZvclRlc3RGaWxlIiwiYXNzZXJ0aW9uc0ZvclRlc3RGaWxlIiwic3RhdGVGb3JUZXN0QXNzZXJ0aW9uIiwiZmluZCIsImEiXSwic291cmNlcyI6WyIuLi9zcmMvdGVzdF9yZWNvbmNpbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIGNsYXNzLW1ldGhvZHMtdXNlLXRoaXMgKi9cbi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuXG4gKlxuICogQGZsb3dcbiAqL1xuXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB0eXBlIHtUZXN0RmlsZUFzc2VydGlvblN0YXR1cywgVGVzdEFzc2VydGlvblN0YXR1cywgVGVzdFJlY29uY2lsaWF0aW9uU3RhdGUsIExvY2F0aW9ufSBmcm9tICcuL3R5cGVzJztcblxuaW1wb3J0IHR5cGUge0Zvcm1hdHRlZEFzc2VydGlvblJlc3VsdCwgRm9ybWF0dGVkVGVzdFJlc3VsdHN9IGZyb20gJy4uL3R5cGVzL1Rlc3RSZXN1bHQnO1xuXG4vKipcbiAqICBZb3UgaGF2ZSBhIEplc3QgdGVzdCBydW5uZXIgd2F0Y2hpbmcgZm9yIGNoYW5nZXMsIGFuZCB5b3UgaGF2ZVxuICogIGFuIGV4dGVuc2lvbiB0aGF0IHdhbnRzIHRvIGtub3cgd2hlcmUgdG8gc2hvdyBlcnJvcnMgYWZ0ZXIgZmlsZSBwYXJzaW5nLlxuICpcbiAqICBUaGlzIGNsYXNzIHJlcHJlc2VudHMgdGhlIHN0YXRlIGJldHdlZW4gcnVucywga2VlcGluZyB0cmFjayBvZiBwYXNzZXMvZmFpbHNcbiAqICBhdCBhIGZpbGUgbGV2ZWwsIGdlbmVyYXRpbmcgdXNlZnVsIGVycm9yIG1lc3NhZ2VzIGFuZCBwcm92aWRpbmcgYSBuaWNlIEFQSS5cbiAqL1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVGVzdFJlY29uY2lsZXIge1xuICBmaWxlU3RhdHVzZXM6IHtba2V5OiBzdHJpbmddOiBUZXN0RmlsZUFzc2VydGlvblN0YXR1c307XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5maWxlU3RhdHVzZXMgPSB7fTtcbiAgfVxuXG4gIC8vIHRoZSBwcm9jZXNzZWQgdGVzdCByZXN1bHRzIHdpbGwgYmUgcmV0dXJuZWQgaW1tZWRpYXRlbHkgaW5zdGVhZCBvZiBzYXZlZCBpblxuICAvLyBpbnN0YW5jZSBwcm9wZXJ0aWVzLiBUaGlzIGlzIDEpIHRvIHByZXZlbnQgcmFjZSBjb25kaXRpb24gMikgdGhlIGRhdGEgaXMgYWxyZWFkeVxuICAvLyBzdG9yZWQgaW4gdGhlIHRoaXMuZmlsZVN0YXR1c2VzLCBubyBkdXAgaXMgYmV0dGVyIDMpIGNsaWVudCB3aWxsIG1vc3QgbGlrZWx5IG5lZWQgdG8gcHJvY2Vzc1xuICAvLyBhbGwgdGhlIHJlc3VsdHMgYW55d2F5LlxuICB1cGRhdGVGaWxlV2l0aEplc3RTdGF0dXMocmVzdWx0czogRm9ybWF0dGVkVGVzdFJlc3VsdHMpOiBUZXN0RmlsZUFzc2VydGlvblN0YXR1c1tdIHtcbiAgICAvLyBMb29wIHRocm91Z2ggYWxsIGZpbGVzIGluc2lkZSB0aGUgcmVwb3J0IGZyb20gSmVzdFxuICAgIGNvbnN0IHN0YXR1c0xpc3Q6IFRlc3RGaWxlQXNzZXJ0aW9uU3RhdHVzW10gPSBbXTtcbiAgICByZXN1bHRzLnRlc3RSZXN1bHRzLmZvckVhY2goKGZpbGUpID0+IHtcbiAgICAgIC8vIERpZCB0aGUgZmlsZSBwYXNzL2ZhaWw/XG4gICAgICBjb25zdCBzdGF0dXMgPSB0aGlzLnN0YXR1c1RvUmVjb25jaWxhdGlvblN0YXRlKGZpbGUuc3RhdHVzKTtcbiAgICAgIC8vIENyZWF0ZSBvdXIgb3duIHNpbXBsZXIgcmVwcmVzZW50YXRpb25cbiAgICAgIGNvbnN0IGZpbGVTdGF0dXM6IFRlc3RGaWxlQXNzZXJ0aW9uU3RhdHVzID0ge1xuICAgICAgICBhc3NlcnRpb25zOiB0aGlzLm1hcEFzc2VydGlvbnMoZmlsZS5uYW1lLCBmaWxlLmFzc2VydGlvblJlc3VsdHMpLFxuICAgICAgICBmaWxlOiBmaWxlLm5hbWUsXG4gICAgICAgIG1lc3NhZ2U6IGZpbGUubWVzc2FnZSxcbiAgICAgICAgc3RhdHVzLFxuICAgICAgfTtcbiAgICAgIHRoaXMuZmlsZVN0YXR1c2VzW2ZpbGUubmFtZV0gPSBmaWxlU3RhdHVzO1xuICAgICAgc3RhdHVzTGlzdC5wdXNoKGZpbGVTdGF0dXMpO1xuICAgIH0pO1xuICAgIHJldHVybiBzdGF0dXNMaXN0O1xuICB9XG5cbiAgLyoqXG4gICAqIHJlbW92ZSBqZXN0IHN0YXR1cyBvZiB0aGUgdGVzdCBmaWxlIGZyb20gdGhlIGNhY2hlZCByZXN1bHRzXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmaWxlTmFtZVxuICAgKi9cbiAgcmVtb3ZlVGVzdEZpbGUoZmlsZU5hbWU6IHN0cmluZykge1xuICAgIGRlbGV0ZSB0aGlzLmZpbGVTdGF0dXNlc1tmaWxlTmFtZV07XG4gIH1cblxuICAvLyBBIGZhaWxlZCB0ZXN0IGFsc28gY29udGFpbnMgdGhlIHN0YWNrIHRyYWNlIGZvciBhbiBgZXhwZWN0YFxuICAvLyB3ZSBkb24ndCBnZXQgdGhpcyBhcyBzdHJ1Y3R1cmVkIGRhdGEsIGJ1dCB3aGF0IHdlIGdldFxuICAvLyBpcyB1c2VmdWwgZW5vdWdoIHRvIG1ha2UgaXQgZm9yIG91cnNlbHZlc1xuXG4gIG1hcEFzc2VydGlvbnMoZmlsZW5hbWU6IHN0cmluZywgYXNzZXJ0aW9uczogQXJyYXk8Rm9ybWF0dGVkQXNzZXJ0aW9uUmVzdWx0Pik6IEFycmF5PFRlc3RBc3NlcnRpb25TdGF0dXM+IHtcbiAgICAvLyBjb252ZXJ0IGplc3QgbG9jYXRpb24gKGNvbHVtbiBpcyAwLWJhc2VkIGFuZCBsaW5lIGlzIDEtYmFzZWQpIHRvIGFsbCAwLWJhc2VkIGxvY2F0aW9uIHVzZWQgaW50ZXJuYWxseSBpbiB0aGlzIHBhY2thZ2VcbiAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1wYXJhbS1yZWFzc2lnbiAqL1xuICAgIGNvbnN0IGNvbnZlcnRKZXN0TG9jYXRpb24gPSAoamVzdExvY2F0aW9uOiA/TG9jYXRpb24pID0+IHtcbiAgICAgIGlmIChqZXN0TG9jYXRpb24pIHtcbiAgICAgICAgamVzdExvY2F0aW9uLmxpbmUgLT0gMTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBqZXN0TG9jYXRpb247XG4gICAgfTtcbiAgICAvLyBJcyBpdCBqZXN0IDwgMTc/IGUuZy4gQmVmb3JlIEkgYWRkZWQgdGhpcyB0byB0aGUgSlNPTlxuICAgIGlmICghYXNzZXJ0aW9ucykge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIC8vIENoYW5nZSBhbGwgZmFpbGluZyBhc3NlcnRpb25zIGludG8gc3RydWN0dXJlZCBkYXRhXG4gICAgcmV0dXJuIGFzc2VydGlvbnMubWFwKChhc3NlcnRpb24pID0+IHtcbiAgICAgIC8vIEZhaWx1cmUgbWVzc2FnZXMgc2VlbXMgdG8gYWx3YXlzIGJlIGFuIGFycmF5IG9mIG9uZSBpdGVtXG4gICAgICBjb25zdCBtZXNzYWdlID0gYXNzZXJ0aW9uLmZhaWx1cmVNZXNzYWdlcyAmJiBhc3NlcnRpb24uZmFpbHVyZU1lc3NhZ2VzWzBdO1xuICAgICAgbGV0IHNob3J0ID0gbnVsbDtcbiAgICAgIGxldCB0ZXJzZSA9IG51bGw7XG4gICAgICBsZXQgbGluZSA9IG51bGw7XG4gICAgICBjb25zdCBsb2NhdGlvbiA9IGNvbnZlcnRKZXN0TG9jYXRpb24oYXNzZXJ0aW9uLmxvY2F0aW9uKTsgLy8gb3V0cHV0IGZyb20gamVzdCAtLXRlc3RMb2NhdGlvbkluUmVzdWx0cyAoaHR0cHM6Ly9qZXN0anMuaW8vZG9jcy9lbi9jbGkjdGVzdGxvY2F0aW9uaW5yZXN1bHRzKVxuICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgLy8gSnVzdCB0aGUgZmlyc3QgbGluZSwgd2l0aCBsaXR0bGUgd2hpdGVzcGFjZVxuICAgICAgICBzaG9ydCA9IG1lc3NhZ2Uuc3BsaXQoJyAgIGF0JywgMSlbMF0udHJpbSgpO1xuICAgICAgICAvLyB0aGlzIHdpbGwgc2hvdyBpbmxpbmUsIHNvIHdlIHdhbnQgdG8gc2hvdyB2ZXJ5IGxpdHRsZVxuICAgICAgICB0ZXJzZSA9IHRoaXMuc2FuaXRpemVTaG9ydEVycm9yTWVzc2FnZShzaG9ydCk7XG4gICAgICAgIGxpbmUgPSB0aGlzLmxpbmVPZkVycm9yKG1lc3NhZ2UsIGZpbGVuYW1lKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxpbmUsXG4gICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UgfHwgJycsXG4gICAgICAgIHNob3J0TWVzc2FnZTogc2hvcnQsXG4gICAgICAgIHN0YXR1czogdGhpcy5zdGF0dXNUb1JlY29uY2lsYXRpb25TdGF0ZShhc3NlcnRpb24uc3RhdHVzKSxcbiAgICAgICAgdGVyc2VNZXNzYWdlOiB0ZXJzZSxcbiAgICAgICAgdGl0bGU6IGFzc2VydGlvbi50aXRsZSxcbiAgICAgICAgbG9jYXRpb24sXG4gICAgICAgIGZ1bGxOYW1lOiBhc3NlcnRpb24uZnVsbE5hbWUsXG4gICAgICAgIGFuY2VzdG9yVGl0bGVzOiBhc3NlcnRpb24uYW5jZXN0b3JUaXRsZXMsXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgLy8gRG8gZXZlcnl0aGluZyB3ZSBjYW4gdG8gdHJ5IG1ha2UgYSBvbmUtbGluZXIgZnJvbSB0aGUgZXJyb3IgcmVwb3J0XG4gIHNhbml0aXplU2hvcnRFcnJvck1lc3NhZ2Uoc3RyaW5nOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGlmIChzdHJpbmcuaW5jbHVkZXMoJ2RvZXMgbm90IG1hdGNoIHN0b3JlZCBzbmFwc2hvdCcpKSB7XG4gICAgICByZXR1cm4gJ1NuYXBzaG90IGhhcyBjaGFuZ2VkJztcbiAgICB9XG5cbiAgICBpZiAoc3RyaW5nLmluY2x1ZGVzKCdOZXcgc25hcHNob3Qgd2FzIG5vdCB3cml0dGVuJykpIHtcbiAgICAgIHJldHVybiAnTmV3IHNuYXBzaG90IGlzIHJlYWR5IHRvIHdyaXRlJztcbiAgICB9XG5cbiAgICByZXR1cm4gc3RyaW5nXG4gICAgICAuc3BsaXQoJ1xcbicpXG4gICAgICAuc3BsaWNlKDIpXG4gICAgICAuam9pbignJylcbiAgICAgIC5yZXBsYWNlKC9cXHNcXHMrL2csICcgJylcbiAgICAgIC5yZXBsYWNlKCdSZWNlaXZlZDonLCAnLCBSZWNlaXZlZDonKVxuICAgICAgLnNwbGl0KCdEaWZmZXJlbmNlOicpWzBdO1xuICB9XG5cbiAgLy8gUHVsbCB0aGUgbGluZSBvdXQgZnJvbSB0aGUgc3RhY2sgdHJhY2VcbiAgbGluZU9mRXJyb3IobWVzc2FnZTogc3RyaW5nLCBmaWxlUGF0aDogc3RyaW5nKTogP251bWJlciB7XG4gICAgY29uc3QgZmlsZW5hbWUgPSBwYXRoLmJhc2VuYW1lKGZpbGVQYXRoKTtcbiAgICBjb25zdCByZXN0T2ZUcmFjZSA9IG1lc3NhZ2Uuc3BsaXQoZmlsZW5hbWUsIDIpWzFdO1xuICAgIHJldHVybiByZXN0T2ZUcmFjZSA/IHBhcnNlSW50KHJlc3RPZlRyYWNlLnNwbGl0KCc6JylbMV0sIDEwKSA6IG51bGw7XG4gIH1cblxuICBzdGF0dXNUb1JlY29uY2lsYXRpb25TdGF0ZShzdGF0dXM6IHN0cmluZyk6IFRlc3RSZWNvbmNpbGlhdGlvblN0YXRlIHtcbiAgICBzd2l0Y2ggKHN0YXR1cykge1xuICAgICAgY2FzZSAncGFzc2VkJzpcbiAgICAgICAgcmV0dXJuICdLbm93blN1Y2Nlc3MnO1xuICAgICAgY2FzZSAnZmFpbGVkJzpcbiAgICAgICAgcmV0dXJuICdLbm93bkZhaWwnO1xuICAgICAgY2FzZSAncGVuZGluZyc6XG4gICAgICAgIHJldHVybiAnS25vd25Ta2lwJztcbiAgICAgIGNhc2UgJ3RvZG8nOlxuICAgICAgICByZXR1cm4gJ0tub3duVG9kbyc7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJ1Vua25vd24nO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRlRm9yVGVzdEZpbGUoZmlsZTogc3RyaW5nKTogVGVzdFJlY29uY2lsaWF0aW9uU3RhdGUge1xuICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLmZpbGVTdGF0dXNlc1tmaWxlXTtcbiAgICBpZiAoIXJlc3VsdHMpIHtcbiAgICAgIHJldHVybiAnVW5rbm93bic7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzLnN0YXR1cztcbiAgfVxuXG4gIGFzc2VydGlvbnNGb3JUZXN0RmlsZShmaWxlOiBzdHJpbmcpOiBUZXN0QXNzZXJ0aW9uU3RhdHVzW10gfCBudWxsIHtcbiAgICBjb25zdCByZXN1bHRzID0gdGhpcy5maWxlU3RhdHVzZXNbZmlsZV07XG4gICAgcmV0dXJuIHJlc3VsdHMgPyByZXN1bHRzLmFzc2VydGlvbnMgOiBudWxsO1xuICB9XG5cbiAgc3RhdGVGb3JUZXN0QXNzZXJ0aW9uKGZpbGU6IHN0cmluZywgbmFtZTogc3RyaW5nKTogVGVzdEFzc2VydGlvblN0YXR1cyB8IG51bGwge1xuICAgIGNvbnN0IHJlc3VsdHMgPSB0aGlzLmZpbGVTdGF0dXNlc1tmaWxlXTtcbiAgICBpZiAoIXJlc3VsdHMgfHwgIXJlc3VsdHMuYXNzZXJ0aW9ucykge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGFzc2VydGlvbiA9IHJlc3VsdHMuYXNzZXJ0aW9ucy5maW5kKChhKSA9PiBhLnRpdGxlID09PSBuYW1lKTtcbiAgICBpZiAoIWFzc2VydGlvbikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiBhc3NlcnRpb247XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVVBLElBQUFBLEtBQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUF3QixTQUFBRCx1QkFBQUUsR0FBQSxXQUFBQSxHQUFBLElBQUFBLEdBQUEsQ0FBQUMsVUFBQSxHQUFBRCxHQUFBLGdCQUFBQSxHQUFBO0FBQUEsU0FBQUUsUUFBQUMsQ0FBQSxzQ0FBQUQsT0FBQSx3QkFBQUUsTUFBQSx1QkFBQUEsTUFBQSxDQUFBQyxRQUFBLGFBQUFGLENBQUEsa0JBQUFBLENBQUEsZ0JBQUFBLENBQUEsV0FBQUEsQ0FBQSx5QkFBQUMsTUFBQSxJQUFBRCxDQUFBLENBQUFHLFdBQUEsS0FBQUYsTUFBQSxJQUFBRCxDQUFBLEtBQUFDLE1BQUEsQ0FBQUcsU0FBQSxxQkFBQUosQ0FBQSxLQUFBRCxPQUFBLENBQUFDLENBQUE7QUFBQSxTQUFBSyxnQkFBQUMsUUFBQSxFQUFBQyxXQUFBLFVBQUFELFFBQUEsWUFBQUMsV0FBQSxlQUFBQyxTQUFBO0FBQUEsU0FBQUMsa0JBQUFDLE1BQUEsRUFBQUMsS0FBQSxhQUFBQyxDQUFBLE1BQUFBLENBQUEsR0FBQUQsS0FBQSxDQUFBRSxNQUFBLEVBQUFELENBQUEsVUFBQUUsVUFBQSxHQUFBSCxLQUFBLENBQUFDLENBQUEsR0FBQUUsVUFBQSxDQUFBQyxVQUFBLEdBQUFELFVBQUEsQ0FBQUMsVUFBQSxXQUFBRCxVQUFBLENBQUFFLFlBQUEsd0JBQUFGLFVBQUEsRUFBQUEsVUFBQSxDQUFBRyxRQUFBLFNBQUFDLE1BQUEsQ0FBQUMsY0FBQSxDQUFBVCxNQUFBLEVBQUFVLGNBQUEsQ0FBQU4sVUFBQSxDQUFBTyxHQUFBLEdBQUFQLFVBQUE7QUFBQSxTQUFBUSxhQUFBZixXQUFBLEVBQUFnQixVQUFBLEVBQUFDLFdB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